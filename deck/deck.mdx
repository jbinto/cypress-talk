import { Appear, Image, Split, themes } from 'mdx-deck'

import meme1 from './meme1.jpg'
import meme2 from './meme2.gif'
import meme3 from './meme3.gif'
import trophy from './trophy.jpg'
import dependabot from './dependabot.png'
import bestPractices from './best_practices.png'

export const theme = themes.book

# Why you should use Cypress

November 12, 2019 @ TouchBistro, Toronto 


<p style={{ position: 'absolute', bottom: '0.2vh'}}>
Jesse Buchanan (@jessebuchananCA)
</p>


---

# Quick demo

<ul>
  <li>ğŸ‰ Let's do the best part first</li>
  <Appear>
    <li>ğŸ“– Cypress ships an example test suite for a "real world" app</li>
    <li><code>conduit</code> is a Medium clone, a learning project cloned in over a dozen languages</li>
    <li>â­</li>
  </Appear>
</ul>

---

# Quick demo


<ul>
  <Appear>
    <span style={{ fontSize: '100px' }}>âŒ¨ â±</span>
    <li>We'll come back to this soon</li>
    <li>â­</li>
  </Appear>
</ul>


---


# What drove us to Cypress?

<ul>
  <Appear>
    <h3>Component tests (e.g. `enzyme` shallow rendering) were fragile</h3>
    <li>â­</li>
  </Appear>
</ul>

---

<Image src={meme2} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

<Image src={meme1} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

<Image src={meme3} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

# What drove us to Cypress?

<ul>
  <h3>Component tests with `enzyme` shallow rendering are fragile</h3>
  <Appear>
    <li>ğŸ’¥ Tests would still pass even if the app is broken</li>
    <li>ğŸ—‘ Tests weren't useful for verifying dependency upgrades</li>
    <li>â­</li>
  </Appear>
</ul>


---

<Image src={dependabot} />

---

# What drove us to Cypress?

<ul>
  <h3>Component tests with `enzyme` shallow rendering are fragile</h3>
  <li>ğŸ’¥ Tests would still pass even if the app is broken</li>
  <li>ğŸ—‘ Tests weren't useful for verifying dependency upgrades</li>
  <Appear>
    <li>ğŸ˜° Refactoring meant re-writing most or all of the tests</li>
    <li>ğŸ’° Which means our tests didn't pay for themselves</li>
    <li>â­</li>
  </Appear>
</ul>

---

# Testing pyramid

<li>ğŸ”º Mostly unit tests</li>

---

# Testing <strike>pyramid</strike>

---

<Split>
  <img src={trophy} />

  # ğŸ† Testing trophy

  <Appear>
    <p>"<a href="https://kentcdodds.com/blog/write-tests">Write tests, not too many, mostly integration</a>" - @kentcdodds</p>
  </Appear>
</Split>

---

# Test "like a user" to enable refactoring

Our mistake was testing <strong>implementation details</strong>.

<ul>
  <Appear>
    <li>ğŸš§ The internals of React were entirely rewritten between React 15 and React 16</li>
    <li>ğŸ‘©â€ğŸ”¬ They only tested their public APIs
      <ul>
        <li>Tests didn't need to be rewritten</li>
        <li>And they actually verified things still worked</li>
      </ul>
    </li>
    <li>ğŸ’»For a web application, <em>the user interface</em> is the public API</li>
    <li>â­</li>
  </Appear>
</ul>

---

<img src={bestPractices} style={{ height: '100%', width: 'auto' }} />

---

# Cypress is designed for reliability

<Appear>
  <li>ğŸ•´ It hides the complexities of async</li>
  <li>ğŸš« You can always* write deterministic, flake-free tests</li>
  <li>ğŸ‘¨â€âš–ï¸ (* if you follow the rules)</li>
  <li>â­</li>
</Appear>

---

# Cypress has great documentation

<ul>
  <Appear>
    <li>ğŸ”¤ <a href="https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html#Cypress-Can-Be-Simple-Sometimes">It's simple (sometimes)</a></li>
    <li>ğŸ‘®â€â™‚ï¸  But in order to guarantee reliability, you need to follow rules</li>
    <li>ğŸ‘¨â€ğŸ“ You may need to unlearn the way you've tested in other environments</li>
    <li>ğŸ“š Read the docs to learn more!</li>
    <li>â­</li>
  </Appear>
</ul>

---

# The tests themselves

<Appear>
  <li>ğŸ§™â€â™‚ï¸ Stub out REST API calls with <code>cy.route()</code></li>
  <li>ğŸ—ï¸ Stub out browser APIs (or your own app's APIs!) with <code>cy.stub()</code></li>
  <li>ğŸ•° Fast-forward in-app timers with <code>cy.tick()</code></li>
  <li>âš™ï¸ Write arbitrary tasks in Node with <code>cy.task()</code></li>
  <li>ğŸ•¸ Make web requests with <code>cy.request()</code></li>
  <li>â­</li>
</Appear>

---

# The test runner

<Appear>
  <li>âŒšï¸ You can view snapshots, "before"/"after" of each test step</li>
  <li>ğŸ”“ You can access the console, and interact with your app</li>
  <li>ğŸ¥ You can record screenshots and videos of test runs</li>
  <li>ğŸ§¾ You can get code coverage metrics</li>
</Appear>

---

# Demo, again

---

# Demo, again

â­

---

# Why you (maybe) shouldn't use Cypress

Nothing is perfect. Some areas Cypress is working on:

<ul>
  <li>No Firefox support - <a href="https://github.com/cypress-io/cypress/issues/1096">GH #1096</a></li>
  <li>Full network stubbing (fetch support) - <a href="https://github.com/cypress-io/cypress/issues/687">GH #687</a></li>
  <li><a href="https://docs.cypress.io/guides/guides/web-security.html#External-Navigation">One "superdomain" per test</a></li>
</ul>

---

# Thanks!

<p style={{ position: 'absolute', bottom: '0.2vh'}}>
Jesse Buchanan (@jessebuchananCA)
</p>