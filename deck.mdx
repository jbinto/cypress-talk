import { Appear, Image, Split, themes } from 'mdx-deck'

import meme1 from './meme1.jpg'
import meme2 from './meme2.gif'
import meme3 from './meme3.gif'
import trophy from './trophy.jpg'
import dependabot from './dependabot.png'
import bestPractices from './best_practices.png'
import testInternals from './test_internals.png'

export const theme = themes.swiss

# Why you should use Cypress

November 12, 2019 @ TouchBistro, Toronto 

<p style={{ position: 'absolute', bottom: '0vh'}}>
Jesse Buchanan (@jessebuchananCA)
</p>

---

<img src="https://www.cypress.io/static/33498b5f95008093f5f94467c61d20ab/59c46/cypress-logo.webp"/>
<h3>"Fast, easy and reliable testing for anything that runs in a browser."</h3>

---

# Quick demo

<ul>
  <li>ğŸ‰ Let's do the best part first</li>
  <Appear>
    <li>Cypress ships an example test suite for a "real world" app (Medium clone)</li>
    <li>Let's walk through some neat features and a bit of code</li>
    <li>â­</li>
  </Appear>
</ul>

---

<!-- # Quick demo


<ul>
  <Appear>
    <span style={{ fontSize: '100px' }}>âŒ¨ â±</span>
    <li>We'll come back to this soon</li>
    <li>â­</li>
  </Appear>
</ul> -->


<!-- --- -->


# What drove us to Cypress?

<ul>
  <Appear>
    <h3>React component tests (e.g. <code>enzyme</code>) were fragile</h3>
    <li>â­</li>
  </Appear>
</ul>

---

<Image src={meme2} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

<Image src={meme1} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

<Image src={meme3} />
<p style={{ fontSize: '40px', position: 'absolute', top: 0 }}>2 unit tests, 0 integration tests ğŸ¤£</p>

---

# What drove us to Cypress?

<ul>
  <h3>React component tests (e.g. <code>enzyme</code>) were fragile</h3>
  <Appear>
    <li>ğŸ’¥ Tests would still pass even if the app is broken</li>
    <li>ğŸ—‘ Tests weren't useful for verifying dependency upgrades</li>
    <li>â­</li>
  </Appear>
</ul>


---

<Image src={dependabot} />

---

# What drove us to Cypress?

<ul>
  <h3>React component tests (e.g. <code>enzyme</code>) were fragile</h3>
  <li>ğŸ’¥ Tests would still pass even if the app is broken</li>
  <li>ğŸ—‘ Tests weren't useful for verifying dependency upgrades</li>
  <Appear>
    <li>ğŸ˜° Refactoring meant re-writing most or all of the tests</li>
    <li>ğŸ’° Which means our tests didn't pay for themselves</li>
    <li>â­</li>
  </Appear>
</ul>

---

<!-- # Testing pyramid

<li>ğŸ”º Mostly unit tests</li>

---

# Testing <strike>pyramid</strike>

---

<Split>
  <img src={trophy} />

  # ğŸ† Testing trophy

  <Appear>
    <p>"<a href="https://kentcdodds.com/blog/write-tests">Write tests, not too many, mostly integration</a>" - @kentcdodds</p>
  </Appear>
</Split>

--- -->

# Test "like a user" to enable refactoring

Our mistake was testing <strong>implementation details</strong>.



<ul>
  <Appear>
    <center>âš›ï¸</center>
    <li>ğŸš§ React's internals were entirely rewritten between v15 and v16</li> 
    <li>ğŸ‘©â€ğŸ”¬ They only tested their public APIs</li>
  </Appear>
</ul>

---

<img src={testInternals} style={{ height: '100%', width: 'auto' }} />

---

# Test "like a user" to enable refactoring

Our mistake was testing <strong>implementation details</strong>.

<ul>
  <li>ğŸš§ React's internals were entirely rewritten between v15 and v16</li>
  <li>ğŸ‘©â€ğŸ”¬ They only tested their public APIs</li>
</ul>

<ul>
  <li>Tests didn't need to be rewritten</li>
  <li>And they actually verified things still worked</li>
  <li>â­</li>
</ul>

---


<h3 style={{ 'height': '100%'}}>ğŸ’» For a web application, <em>the user interface</em> is the public API</h3>

---

<img src={bestPractices} style={{ height: '100%', width: 'auto' }} />

--- 

# Cypress is designed for reliability

<Appear>
  <li>âœ… It helps you avoid timing bugs with <em>retry-ability</em></li>
  <li>ğŸš« You can always* write deterministic, flake-free tests...</li>
  <li>â³ ...and you never* have to write manual "wait for 1000ms"</li>
  <li>ğŸ‘¨â€âš–ï¸ ...if you follow the rules. Don't worry, Cypress has great documentation!</li>
  <li>â­</li>
</Appear>

---

# Tradeoffs for reliability

<Appear>
  <li>It's JavaScript, but not like you're used to</li>
  <li>You can't write <a href="https://docs.cypress.io/guides/core-concepts/conditional-testing.html">conditional tests</a>: no branching or logic allowed</li>
  <li>But you have options. Did I mention Cypress has great documentation?</li>
  <li>â­</li>
</Appear>

---

# The tests themselves

<Appear>
  <li>ğŸ§™â€â™‚ï¸ Stub out REST API calls with <a href="https://docs.cypress.io/api/commands/route.html#Making-multiple-requests-to-the-same-route"><code>cy.route()</code></a></li>
  <li>ğŸ—ï¸ Stub out browser APIs (or your own app's APIs!) with <code>cy.stub()</code></li>
  <li>ğŸ•° Fast-forward in-app timers with <code>cy.tick()</code></li>
  <li>âš™ï¸  Call <a href="https://github.com/cypress-io/cypress-example-realworld/blob/e3d4a12437851a40770ddbc90fbed65a3e7ca9ba/cypress/plugins/index.js#L13">arbitrary tasks</a> in Node with <code>cy.task()</code></li>
  <li>ğŸ•¸ Make web requests with <code>cy.request()</code></li>
  <li>â­</li>
</Appear>

---

# The test runner

<Appear>
  <li>âŒšï¸ You can view snapshots, "before"/"after" of each test step</li>
  <li>ğŸ”“ You can access the console, and interact with your app</li>
  <li>ğŸ¥ You can record screenshots and videos of test runs</li>
  <li>ğŸ§¾ You can get code coverage metrics</li>
</Appear>

<!-- ---

# Demo, again

---

# Demo, again

â­ -->

---

# Why you (maybe) shouldn't use Cypress

Nothing is perfect. Some areas Cypress is working on:

<ul>
  <li>No Firefox support - <a href="https://github.com/cypress-io/cypress/issues/1096">GH #1096</a></li>
  <li>Full network stubbing (fetch support) - <a href="https://github.com/cypress-io/cypress/issues/687">GH #687</a>, workarounds</li>
  <li><a href="https://docs.cypress.io/guides/guides/web-security.html#External-Navigation">One "superdomain" per test</a>, workarounds</li>
</ul>

---

# Read the docs!

<ul>
  <li>Some of the best technical writing I've encountered</li>
</ul>

---

# Thanks!

<h2>Slides: <a style={{ 'textDecoration': 'none' }} href="http://why-cypress.netlify.com/">http://why-cypress.netlify.com/</a></h2>

<p style={{ position: 'absolute', bottom: '0.2vh'}}>
Jesse Buchanan (@jessebuchananCA)
</p>